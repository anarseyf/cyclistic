```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
install.packages("ggplot2", repos = "http://cran.us.r-project.org")
library(ggplot2)
library(dplyr)
```
# Cyclistic

- Anar Seyf (anar.seyf@gmail.com)
- October 2021
- Capstone project | Google Data Analytics course #8 | Coursera


## The Data

#### Duration by weekday

```{r, echo = FALSE}
agg_daily_computed_weekdays <- read.csv("agg_daily_computed_weekdays.csv")
head(agg_daily_computed_weekdays, n = 3)
```

#### Aggregate: daily duration and count
```{r, echo = FALSE}
agg_daily <- read.csv("agg_daily_duration_count.csv")
head(agg_daily, n = 3)
```

#### Aggregate: daily duration and count
```{r, echo = FALSE}
agg_daily <- read.csv("agg_daily_duration_count.csv")
head(agg_daily, n = 3)
```

## The Graphs

#### Aggregate by day of week

Note: February, non-member: abnormally high duration.

```{r, include = FALSE}
agg_summarized <- agg_daily %>%
  group_by(YEAR_MONTH, DAYOFWEEK, IS_MEMBER) %>%
  summarize(MEAN_DURATION = mean(AVG_DURATION), MEAN_COUNT = mean(COUNT))
head(agg_daily)
head(agg_summarized)
```

#### Monthly

```{r, echo = FALSE}
plot <- agg_daily_computed_weekdays %>%
  group_by(year_month, dayofweek, IS_MEMBER) %>%
  summarize(AVG_COUNT = mean(COUNT), AVG_DURATION = mean(AVG_DURATION))
head(plot)
plot %>%
  ggplot(aes(x = dayofweek, y = AVG_COUNT, color = IS_MEMBER, size = AVG_DURATION)) +
  geom_point() +
  facet_wrap(~year_month, ncol = 3)
```

#### Overall

```{r, echo = FALSE}
plot <- agg_daily_computed_weekdays %>%
  group_by(dayofweek, IS_MEMBER) %>%
  summarize(AVG_COUNT = mean(COUNT), AVG_DURATION = mean(AVG_DURATION))
head(plot)
plot %>%
  ggplot(aes(x = dayofweek, y = AVG_COUNT, color = IS_MEMBER, size = AVG_DURATION)) +
  geom_point()
```

#### Total Counts and Average Duration

Full year, weekly.

```{r fig1, echo = FALSE, fig.width=3, fig.height=6}
agg_weekly <- read.csv("agg_weekly_duration_count_INCORRECT.csv")
head(agg_weekly, n = 3)
ggplot(data = agg_weekly, aes(y = factor(WEEK, levels = unique(rev(WEEK))), x = total_count, fill = IS_MEMBER)) +
  geom_col() +
  theme(legend.position = "none")
```
```{r, echo = FALSE, fig.width=4, fig.height=6}
ggplot(data = agg_weekly, aes(y = factor(WEEK, levels = unique(rev(WEEK))), x = avg_duration, fill = IS_MEMBER)) +
  geom_col(width = 1, position = position_dodge(0.5))
```


## The Weather

```{r, echo = FALSE}
weather <- read.csv("agg-daily-trips-weather.csv")
weather %>%
  select(-wind_2min_peak, -temp_min, -temp_max) %>%
  head(n = 3)
```


#### Temperature

In degrees C.

```{r, out.width='49%', out.aspect=0.3, echo = FALSE}

ggplot(data = weather, aes(x = temp_avg, y = COUNT, color = IS_MEMBER, size = AVG_DURATION)) +
  geom_point()
```
```{r, out.width='49%', out.aspect=0.3, echo = FALSE}
ggplot(data = weather, aes(x = temp_avg, fill = IS_MEMBER, size = AVG_DURATION)) +
  geom_histogram(binwidth = 1)
```

```{r, out.width='45%', echo = FALSE}
weather %>%
  ggplot(aes(x = temp_avg, y = COUNT, fill = IS_MEMBER, size = AVG_DURATION)) +
  geom_col(position = "fill") +
  scale_x_binned() +
  scale_y_continuous(labels = scales::percent) +
  theme(legend.position = "none")
```


#### Rain

Rain (mm) vs ride count

```{r, out.width='45%', out.aspect=0.3, echo = FALSE}
weather %>%
  filter(rain <= 20) %>%
  ggplot(aes(x = rain, fill = IS_MEMBER, size = AVG_DURATION)) +
  geom_histogram(binwidth = 1) +
  scale_fill_brewer(palette = "Pastel1")
```
```{r, out.width='45%', out.aspect=0.3, echo = FALSE}
weather %>%
  filter(rain <= 20) %>%
  ggplot(aes(x = rain, y = COUNT, fill = IS_MEMBER, size = AVG_DURATION)) +
  geom_col(position = "fill") +
  scale_x_binned() +
  scale_y_continuous(labels = scales::percent) +
  theme(legend.position = "none") +
  scale_fill_brewer(palette = "Pastel1")
```


#### Wind

Wind (m/s) vs ride count.

Second graph is scaled to 100% to show member vs casual share.

```{r, out.width='35%', echo = FALSE}
weather %>%
  filter(wind_avg <= 10) %>%
  ggplot(aes(x = wind_avg, y = COUNT, fill = IS_MEMBER, size = AVG_DURATION)) +
  geom_col() +
  scale_x_binned() +
  scale_fill_brewer(palette = "Pastel1")
```
```{r, out.width='30%', echo = FALSE}
weather %>%
  filter(wind_avg <= 10) %>%
  ggplot(aes(x = wind_avg, y = COUNT, fill = IS_MEMBER, size = AVG_DURATION)) +
  geom_col(position = "fill") +
  scale_x_binned() +
  scale_fill_brewer(palette = "Pastel1") +
  scale_y_continuous(labels = scales::percent) +
  theme(legend.position = "none")
```